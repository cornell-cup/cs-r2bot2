<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Manual Input</title>
    <meta name="description" content="Source code generated using layoutit.com">
    <meta name="author" content="LayoutIt!">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="favicon-16x16.png" sizes="16x16" />
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <h3 class="text-center">
                    Manual Input
                </h3>
                <ul class="nav nav-tabs">
                    <li>
                        <a href="main.htm">Home</a>
                    </li>
                    <li class="active">
                        <a href="manual.htm">Manual Input</a>
                    </li>
                    <li>
                        <a href="camera.htm">Camera</a>
                    </li>
                    <li>
                        <a href="database.htm">Database</a>
                    </li>
                    <li class="dropdown pull-right">
                        <a href="#" data-toggle="dropdown" class="dropdown-toggle">Dropdown<strong class="caret"></strong></a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="#">Action</a>
                            </li>
                            <li>
                                <a href="#">Another action</a>
                            </li>
                            <li>
                                <a href="#">Something else here</a>
                            </li>
                            <li class="divider">
                            </li>
                            <li>
                                <a href="#">Separated link</a>
                            </li>
                        </ul>
                    </li>
                </ul>

                <div class="row">
                    <div class="col-md-12">
                        <h3 class="text-left">
                            Locomotion
                        </h3>
                        <div id="container">
                            <canvas id="canvas" width="700" height="700">
                                This text is displayed if your browser does not support HTML5 Canvas.
                            </canvas>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <h3>
                            Head Rotation
                        </h3>
                        
                        <button type="button" class="btn btn-default">
                            Left
                        </button>
                        <button type="button" class="btn btn-default">
                            Right
                        </button>
                        <button type="button" class="btn btn-default">
                            Stop
                        </button>
                    </div>
                </div>

                <h3> Map</h3>

                <canvas id="main" height="301" width="301 "></canvas>

            </div>

        </div>
    </div>
    <script src="joystick.js"></script>
   
    <script>
        var sock = new WebSocket("ws://" + location.host + "/wsm");
        sock.binaryType = "arraybuffer";
        sock.onopen = () => {
            console.log('open');

            setInterval(function () {
                sock.send((dataCoordX / rad).toString() + " " + (dataCoordY / rad).toString());
            }, 300);
        }
        sock.onerror = (e) => {
            console.log('error', e)
        }
        sock.onclose = () => {
            console.log('close')
        }
        sock.onmessage = function (e) {
            if (e.data) {
                drawMap(e.data);
            }
        }

        function drawMap(data) {
          var map = [
          [1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
          [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
          [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
          [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
          [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
          [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
          [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
          [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
          [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
          [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
          ];
        

          var dist =arrayBufferToString(data);

          console.log(dist);

          function arrayBufferToString(buffer) {
              var arr = new Uint8Array(buffer);
              var str = String.fromCharCode.apply(String, arr);
              if (/[\u0080-\uffff]/.test(str)) {
                  throw new Error("this string seems to contain (still encoded) multibytes");
              }
              return str;
          }
          
            var ctx = document.getElementById('main').getContext('2d');

            for (var i = 0; i < map.length; i++) {
                for (var j = 0; j < map[i].length; j++) {
                    if (map[i][j] === 1) {
                        ctx.fillStyle = '#FF0000';
                        ctx.fillRect(j * 30, i * 30, 30, 30);
                        map[i][j + dist] = 2;
                    }
                    if (map[i][j] == 2) {
                        ctx.fillStyle = '#FFF000';
                        ctx.fillRect(j * 30, i * 30, 30, 30);
                    }

                }
            }
        }

        var ctx = document.getElementById('main').getContext('2d');
        function drawBoard() {
            for (var x = 0; x <= 301; x += 30) {
                ctx.moveTo(0.5 + x + 0, 0);
                ctx.lineTo(0.5 + x + 0, 300 + 0);
            }


            for (var x = 0; x <= 301; x += 30) {
                ctx.moveTo(0, 0.5 + x + 0);
                ctx.lineTo(300 + 0, 0.5 + x + 0);
            }

            ctx.strokeStyle = "black";
            ctx.stroke();
        }

        drawBoard();


    </script>
</body>
</html>